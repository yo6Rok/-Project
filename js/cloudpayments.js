!function(e){"use strict";function t(e,t,n,o,i,r,a){try{var s=e[r](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,i)}function n(e){return function(){var n=this,o=arguments;return new Promise((function(i,r){var a=e.apply(n,o);function s(e){t(a,i,r,s,l,"next",e)}function l(e){t(a,i,r,s,l,"throw",e)}s(void 0)}))}}function o(e,t,n){return t=l(t),f(e,u()?Reflect.construct(t,n||[],l(e).constructor):t.apply(e,n))}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,v(o.key),o)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return(t=v(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(u=function(){return!!e})()}function d(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(){m=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,o){var r=t&&t.prototype instanceof g?t:g,a=Object.create(r.prototype),s=new R(o||[]);return i(a,"_invoke",{value:I(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var h="suspendedStart",p="suspendedYield",f="executing",y="completed",v={};function g(){}function w(){}function b(){}var P={};c(P,a,(function(){return this}));var C=Object.getPrototypeOf,O=C&&C(C(j([])));O&&O!==n&&o.call(O,a)&&(P=O);var E=b.prototype=g.prototype=Object.create(P);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(i,r,a,s){var l=d(e[i],e,r);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==typeof u&&o.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(u).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var r;i(this,"_invoke",{value:function(e,o){function i(){return new t((function(t,i){n(e,o,t,i)}))}return r=r?r.then(i,i):i()}})}function I(t,n,o){var i=h;return function(r,a){if(i===f)throw Error("Generator is already running");if(i===y){if("throw"===r)throw a;return{value:e,done:!0}}for(o.method=r,o.arg=a;;){var s=o.delegate;if(s){var l=_(s,o);if(l){if(l===v)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(i===h)throw i=y,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);i=f;var c=d(t,n,o);if("normal"===c.type){if(i=o.done?y:p,c.arg===v)continue;return{value:c.arg,done:o.done}}"throw"===c.type&&(i=y,o.method="throw",o.arg=c.arg)}}}function _(t,n){var o=n.method,i=t.iterator[o];if(i===e)return n.delegate=null,"throw"===o&&t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+o+"' method")),v;var r=d(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;var a=r.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function n(){for(;++i<t.length;)if(o.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}throw new TypeError(typeof t+" is not iterable")}return w.prototype=b,i(E,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:w,configurable:!0}),w.displayName=c(b,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,c(e,l,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},S(k.prototype),c(k.prototype,s,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,o,i,r){void 0===r&&(r=Promise);var a=new k(u(e,n,o,i),r);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(E),c(E,l,"Generator"),c(E,a,(function(){return this})),c(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},t.values=j,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(o,i){return s.type="throw",s.arg=t,n.next=o,i&&(n.method="next",n.arg=e),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var i=o.arg;A(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,o){return this.delegate={iterator:j(t),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=e),v}},t}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function v(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}const w={SINGLE:"Single",DUAL:"Dual"},b={REQUIRED:"Required",HIDDEN:"Hidden",OPTIONAL:"Optional"},P="ApplePay";var C=function(){return a((function e(){i(this,e)}),null,[{key:"currentModel",value:function(){return this.getModel()}},{key:"getModel",value:function(){var e=void 0;if(null==this.iosVer&&(this.iosVer=parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||!1),this.iosVer>=12.2)return O.IPhone_NotDetected;var t=window.devicePixelRatio;if(void 0===this.canvasEl&&(this.canvasEl=document.createElement("canvas")),this.canvasEl){var n=this.canvasEl.getContext("webgl")||this.canvasEl.getContext("experimental-webgl");if(n){var o=n.getExtension("WEBGL_debug_renderer_info");o&&(e=n.getParameter(o.UNMASKED_RENDERER_WEBGL))}}if(896!==window.screen.height||414!==window.screen.width||3!==window.devicePixelRatio&&2!==window.devicePixelRatio)if(812===window.screen.height&&375===window.screen.width)switch(e){default:case"Apple A11 GPU":return O.IPhone_X;case"Apple A12 GPU":return O.IPhone_XS}else if(736===window.screen.height&&414===window.screen.width&&3===window.devicePixelRatio)switch(e){default:case"Apple A8 GPU":return O.IPhone_6_PLUS;case"Apple A9 GPU":return O.IPhone_6S_PLUS;case"Apple A10 GPU":return O.IPhone_7_PLUS;case"Apple A11 GPU":return O.IPhone_8_PLUS}else if(667===window.screen.height&&375===window.screen.width&&3===window.devicePixelRatio)switch(e){default:case"Apple A8 GPU":return O.IPhone_6_PLUS;case"Apple A9 GPU":return O.IPhone_6S_PLUS;case"Apple A10 GPU":return O.IPhone_7_PLUS;case"Apple A11 GPU":return O.IPhone_8_PLUS}else if(667===window.screen.height&&375===window.screen.width&&2===window.devicePixelRatio)switch(e){default:case"Apple A8 GPU":return O.IPhone_6;case"Apple A9 GPU":return O.IPhone_6S;case"Apple A10 GPU":return O.IPhone_7;case"Apple A11 GPU":return O.IPhone_8}else if(window.screen.height/window.screen.width==1.775&&2===window.devicePixelRatio)switch(e){default:case"PowerVR SGX 543":return O.IPhone_5;case"Apple A7 GPU":return O.IPhone_5S;case"Apple A8 GPU":return O.IPhone_6;case"Apple A9 GPU":return O.IPhone_SE;case"Apple A10 GPU":return O.IPhone_7;case"Apple A11 GPU":return O.IPhone_8}else if(window.screen.height/window.screen.width==1.5&&2===window.devicePixelRatio)switch(e){default:case"PowerVR SGX 535":return O.IPhone_4;case"PowerVR SGX 543":return O.IPhone_4S}else{if(window.screen.height/window.screen.width!=1.5||1!==window.devicePixelRatio)return e&&e.match("Apple")&&this.iosVer?O.IPhone:O.Not_IPhone;switch(e){default:case"S5L8900":return O.IPhone;case"ALP0298C05":return O.IPhone_3GS}}else switch(t){default:case 2:return O.IPhone_XR;case 3:return O.IPhone_XS_Max}}}])}();s(C,"iosVer",null);var O=function(e){return e[e.Not_IPhone=0]="Not_IPhone",e[e.IPhone=1]="IPhone",e[e.IPhone_3G=3]="IPhone_3G",e[e.IPhone_3GS=3.1]="IPhone_3GS",e[e.IPhone_4=4]="IPhone_4",e[e.IPhone_4S=4.1]="IPhone_4S",e[e.IPhone_5=5]="IPhone_5",e[e.IPhone_5C=5.1]="IPhone_5C",e[e.IPhone_5S=5.2]="IPhone_5S",e[e.IPhone_SE=6]="IPhone_SE",e[e.IPhone_6=6.1]="IPhone_6",e[e.IPhone_6_PLUS=6.2]="IPhone_6_PLUS",e[e.IPhone_6S=6.3]="IPhone_6S",e[e.IPhone_6S_PLUS=6.4]="IPhone_6S_PLUS",e[e.IPhone_7=7]="IPhone_7",e[e.IPhone_7_PLUS=7.1]="IPhone_7_PLUS",e[e.IPhone_8=8]="IPhone_8",e[e.IPhone_8_PLUS=8.1]="IPhone_8_PLUS",e[e.IPhone_X=10]="IPhone_X",e[e.IPhone_XR=10.1]="IPhone_XR",e[e.IPhone_XS=10.2]="IPhone_XS",e[e.IPhone_XS_Max=10.3]="IPhone_XS_Max",e[e.IPhone_NotDetected=1e6]="IPhone_NotDetected",e}({}),E=function(){return a((function e(){i(this,e),this.iPhoneVersion=C.currentModel()}),[{key:"isAndroid",get:function(){return!!navigator.userAgent.match(/Android/g)}},{key:"isIOs",get:function(){return!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g)}},{key:"isIphone",get:function(){return this.iPhoneVersion!==O.Not_IPhone}},{key:"isIpad",get:function(){return!!navigator.userAgent.match(/iPad/i)}},{key:"isAndroidTablet",get:function(){return!!navigator.userAgent.match(/Tablet/i)||this.isAndroid&&screen.width>=720}},{key:"isTablet",get:function(){return this.isIpad||this.isAndroidTablet}},{key:"isMobile",get:function(){return!!navigator.userAgent.match(/Mobile|Phone/i)}},{key:"isMobileSbpSpecific",get:function(){return this.isMobile||this.isIphone||this.isAndroid||void 0!==g(window.orientation)&&!this.isTablet&&document.documentElement.clientWidth<481}}])}(),S=function(){return a((function e(){i(this,e)}),null,[{key:"isNullOrUndefined",value:function(e){return null==e}},{key:"removeClass",value:function(e,t){for(var n=e.className;-1!==n.indexOf(t);)n=(n=n.replace(t,"")).trim();e.className=n}},{key:"hideHtmlElement",value:function(e){e.style.opacity="0",e.style.display="none"}},{key:"showHtmlElement",value:function(e){e.style.display="",e.style.opacity="1",e.style.zIndex="999999"}},{key:"addClass",value:function(e,t){e.className+=" ".concat(t)}},{key:"loadScript",value:(e=n(m().mark((function e(t){var n,o=this,i=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:document.body,e.abrupt("return",new Promise(function(e,i){var r=this;d(this,o);var a=document.createElement("script");a.type="text/javascript",a.src=t,a.addEventListener("load",function(){return d(this,r),e()}.bind(this),!1),a.addEventListener("error",function(){return d(this,r),i()}.bind(this),!1),n.appendChild(a)}.bind(this)));case 2:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})},{key:"isIE",value:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/");return t>0||n>0}},{key:"getQueryParameterByName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.location.href;e=e.replace(/[[\]]/g,"\\$&");var n=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(t);return n&&n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):null}},{key:"getHostnameFromUrl",value:function(e){var t=e.match(/^https?:\/\/([^/?#]+)(?:[/?#]|$)/i);return t&&t[1]}}]);var e}();function k(e){var t=e.createElement("div");t.id="payment-loading-overlay-63456123",t.style.cssText="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; text-align: center; background-color: transparent; z-index: 9999; display: flex; justify-content: center; align-items: center;";var n=(new DOMParser).parseFromString('<svg width="160" height="160" viewBox="0 0 160 160" fill="none" xmlns="http://www.w3.org/2000/svg" id="payment-loading-overlay-loader-63456123">\n  <path d="M120 80C120 102.091 102.091 120 80 120C57.9086 120 40 102.091 40 80C40 57.9086 57.9086 40 80 40C102.091 40 120 57.9086 120 80ZM46.4 80C46.4 98.5568 61.4432 113.6 80 113.6C98.5568 113.6 113.6 98.5568 113.6 80C113.6 61.4432 98.5568 46.4 80 46.4C61.4432 46.4 46.4 61.4432 46.4 80Z" fill="#E2E8EF"></path>\n  <path d="M116.8 80C118.567 80 120.013 78.565 119.872 76.8033C119.37 70.5458 117.401 64.4781 114.106 59.1001C110.251 52.8102 104.732 47.7088 98.1596 44.3597C91.5868 41.0107 84.2158 39.5445 76.8616 40.1233C69.5075 40.7021 62.4566 43.3033 56.4886 47.6393C50.5206 51.9753 45.8678 57.8773 43.0448 64.6927C40.2218 71.508 39.3385 78.9713 40.4925 86.2574C41.6465 93.5434 44.7929 100.368 49.5838 105.978C53.6802 110.774 58.8424 114.522 64.6386 116.933C66.2704 117.611 68.082 116.68 68.6282 114.999C69.1743 113.318 68.2465 111.527 66.6252 110.823C61.9478 108.794 57.7799 105.72 54.4504 101.821C50.426 97.1095 47.783 91.3765 46.8137 85.2562C45.8443 79.1359 46.5863 72.8667 48.9577 67.1418C51.329 61.4169 55.2373 56.4593 60.2504 52.817C65.2636 49.1748 71.1863 46.9898 77.3638 46.5036C83.5413 46.0174 89.7329 47.249 95.2541 50.0622C100.775 52.8754 105.411 57.1606 108.649 62.444C111.327 66.8153 112.963 71.729 113.448 76.8047C113.616 78.564 115.033 80 116.8 80Z" fill="#2E71FC"></path>\n  </svg>',"image/svg+xml").firstChild,o=e.createElement("span");o.appendChild(n),o.style.cssText="position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);";var i=e.createElement("style");i.type="text/css";i.appendChild(e.createTextNode("@-webkit-keyframes rotating /* Safari and Chrome */ {\n              from {\n                -webkit-transform: rotate(0deg);\n                -o-transform: rotate(0deg);\n                transform: rotate(0deg);\n              }\n              to {\n                -webkit-transform: rotate(360deg);\n                -o-transform: rotate(360deg);\n                transform: rotate(360deg);\n              }\n            }\n            @keyframes rotating {\n              from {\n                -ms-transform: rotate(0deg);\n                -moz-transform: rotate(0deg);\n                -webkit-transform: rotate(0deg);\n                -o-transform: rotate(0deg);\n                transform: rotate(0deg);\n              }\n              to {\n                -ms-transform: rotate(360deg);\n                -moz-transform: rotate(360deg);\n                -webkit-transform: rotate(360deg);\n                -o-transform: rotate(360deg);\n                transform: rotate(360deg);\n              }\n            }\n            #payment-loading-overlay-63456123 #payment-loading-overlay-loader-63456123{\n              -webkit-animation: rotating 2s linear infinite;\n              -moz-animation: rotating 2s linear infinite;\n              -ms-animation: rotating 2s linear infinite;\n              -o-animation: rotating 2s linear infinite;\n              animation: rotating 2s linear infinite;\n            }\n            ")),t.appendChild(i),t.appendChild(o),e.body.appendChild(t)}var I=function(e){return e.Auth="auth",e.Charge="charge",e}({}),_=function(e){return e[e.NToOne=0]="NToOne",e[e.OneToN=1]="OneToN",e}({}),x=function(){return a((function e(t,n,o){var r,a,s=this;if(i(this,e),this.auth=n===I.Auth,this.publicId=t.publicId,this.description=t.description,this.amount=t.amount,this.currency=null===(r=t.currency)||void 0===r?void 0:r.toUpperCase(),t.invoiceId&&(this.invoiceId=String(t.invoiceId)),this.accountId=t.accountId,this.localOrder=t.localOrder,this.cryptogramMode=null!==(a=t.cryptogramMode)&&void 0!==a?a:o,this.email=t.email,this.requireEmail=t.requireEmail,this.disableEmail=t.disableEmail,this.skin=t.skin,this.retryPayment=t.retryPayment,this.payer=t.payer,this.payerServiceFee=t.payerServiceFee,this.escrow=t.escrow,this.autoClose=t.autoClose,this.configuration=t.configuration,this.emailBehavior=t.emailBehavior?t.emailBehavior:this.mapEmailOptionsToEmailBehavior(t.requireEmail,t.disableEmail),this.escrow&&!this.escrow.escrowType&&(this.escrow.escrowType=_.NToOne),null!=t.data)try{this.data=JSON.parse(JSON.stringify(t.data))}catch(e){this.data=t.data}t.infoShopData&&(this.infoShopData=t.infoShopData),Object.keys(this).forEach(function(e){return d(this,s),null==this[e]&&delete this[e]}.bind(this)),e.warnExtraFields(this,t),e.validateOptions(this)}),[{key:"mapEmailOptionsToEmailBehavior",value:function(e,t){return e?b.REQUIRED:t?b.HIDDEN:b.OPTIONAL}}],[{key:"warnExtraFields",value:function(e,t){var n=this;Object.keys(t).forEach(function(t){d(this,n),Object.prototype.hasOwnProperty.call(e,t)||console.warn("Unsupported 'PaymentOptions' field: '".concat(t,"'"))}.bind(this))}},{key:"validateOptions",value:function(e){if(Object.prototype.hasOwnProperty.call(e,"autoClose")){if("number"!=typeof e.autoClose)return delete e.autoClose,void console.warn("Argument 'autoClose' must be a number");e.autoClose<3&&(console.warn("Option 'autoClose' should be equal or greater than 3, but received ".concat(e.autoClose,". Rewritten to 3.")),e.autoClose=3),e.autoClose>10&&(console.warn("Option autoClose' should be equal or lower than 10, but received ".concat(e.autoClose,". Rewritten to 10.")),e.autoClose=10)}}}])}();let A,R,j,M,U;!function(e){e.Call="call",e.Reply="reply",e.Syn="syn",e.SynAck="synAck",e.Ack="ack"}(A||(A={})),function(e){e.Fulfilled="fulfilled",e.Rejected="rejected"}(R||(R={})),function(e){e.ConnectionDestroyed="ConnectionDestroyed",e.ConnectionTimeout="ConnectionTimeout",e.NoIframeSrc="NoIframeSrc"}(j||(j={})),function(e){e.DataCloneError="DataCloneError"}(M||(M={})),function(e){e.Message="message"}(U||(U={}));const N={"http:":"80","https:":"443"},L=/^(https?:)?\/\/([^/:]+)?(:(\d+))?/,T=["file:","data:"];const D=function({name:e,message:t,stack:n}){return{name:e,message:t,stack:n}};let F=0;var W=function(){return++F};const G=function(e){return e?e.split("."):[]},B=function(e,t,n){const o=G(t);return o.reduce((function(e,t,i){return void 0===e[t]&&(e[t]={}),i===o.length-1&&(e[t]=n),e[t]}),e),e},V=function(e,t){const n={};return Object.keys(e).forEach((function(o){const i=e[o],r=function(e,t){const n=G(t||"");return n.push(e),function(e){return e.join(".")}(n)}(o,t);"object"==typeof i&&Object.assign(n,V(i,r)),"function"==typeof i&&(n[r]=i)})),n};var $=function(e,t,n,o,i){const{localName:r,local:a,remote:s,originForSending:l,originForReceiving:c}=t;let u=!1;i(`${r}: Connecting call sender`);const d=function(e){return function(...t){let n;i(`${r}: Sending ${e}() call`);try{s.closed&&(n=!0)}catch(e){n=!0}if(n&&o(),u){const t=new Error(`Unable to send ${e}() call due to destroyed connection`);throw t.code=j.ConnectionDestroyed,t}return new Promise((function(n,o){const u=W(),d=function(t){if(t.source!==s||t.data.penpal!==A.Reply||t.data.id!==u)return;if("*"!==c&&t.origin!==c)return void i(`${r} received message from origin ${t.origin} which did not match expected origin ${c}`);const l=t.data;i(`${r}: Received ${e}() reply`),a.removeEventListener(U.Message,d);let h=l.returnValue;l.returnValueIsError&&(h=function(e){const t=new Error;return Object.keys(e).forEach((function(n){return t[n]=e[n]})),t}(h)),(l.resolution===R.Fulfilled?n:o)(h)};a.addEventListener(U.Message,d);const h={penpal:A.Call,id:u,methodName:e,args:t};s.postMessage(h,l)}))}},h=n.reduce((function(e,t){return e[t]=d(t),e}),{});return Object.assign(e,function(e){const t={};for(const n in e)B(t,n,e[n]);return t}(h)),function(){u=!0}},q=function(e,t,n,o,i){const{destroy:r,onDestroy:a}=o;let s,l;const c={};return function(o){if("*"!==t&&o.origin!==t)return void i(`Parent: Handshake - Received ACK message from origin ${o.origin} which did not match expected origin ${t}`);i("Parent: Handshake - Received ACK");const u={localName:"Parent",local:window,remote:o.source,originForSending:n,originForReceiving:t};s&&s(),s=function(e,t,n){const{localName:o,local:i,remote:r,originForSending:a,originForReceiving:s}=e;let l=!1;const c=function(e){if(e.source!==r||e.data.penpal!==A.Call)return;if("*"!==s&&e.origin!==s)return void n(`${o} received message from origin ${e.origin} which did not match expected origin ${s}`);const i=e.data,{methodName:c,args:u,id:d}=i;n(`${o}: Received ${c}() call`);const h=function(e){return function(t){if(n(`${o}: Sending ${c}() reply`),l)return void n(`${o}: Unable to send ${c}() reply due to destroyed connection`);const i={penpal:A.Reply,id:d,resolution:e,returnValue:t};e===R.Rejected&&t instanceof Error&&(i.returnValue=D(t),i.returnValueIsError=!0);try{r.postMessage(i,a)}catch(e){if(e.name===M.DataCloneError){const t={penpal:A.Reply,id:d,resolution:R.Rejected,returnValue:D(e),returnValueIsError:!0};r.postMessage(t,a)}throw e}}};new Promise((function(e){return e(t[c].apply(t,u))})).then(h(R.Fulfilled),h(R.Rejected))};return i.addEventListener(U.Message,c),function(){l=!0,i.removeEventListener(U.Message,c)}}(u,e,i),a(s),l&&l.forEach((function(e){delete c[e]})),l=o.data.methodNames;const d=$(c,u,l,r,i);return a(d),c}};var z=function(e){let{iframe:t,methods:n={},childOrigin:o,timeout:i,debug:r=!1}=e;const a=function(e){return function(...t){e&&console.log("[Penpal]",...t)}}(r),s=function(e,t){const n=[];let o=!1;return{destroy(i){o||(o=!0,t(`${e}: Destroying connection`),n.forEach((function(e){e(i)})))},onDestroy(e){o?e():n.push(e)}}}("Parent",a),{onDestroy:l,destroy:c}=s;o||(!function(e){if(!e.src&&!e.srcdoc){const e=new Error("Iframe must have src or srcdoc property defined.");throw e.code=j.NoIframeSrc,e}}(t),o=function(e){if(e&&T.find((function(t){return e.startsWith(t)})))return"null";const t=document.location,n=L.exec(e);let o,i,r;return n?(o=n[1]?n[1]:t.protocol,i=n[2],r=n[4]):(o=t.protocol,i=t.hostname,r=t.port),`${o}//${i}${r&&r!==N[o]?`:${r}`:""}`}(t.src));const u="null"===o?"*":o,d=V(n),h=function(e,t,n,o){return function(i){if("*"!==n&&i.origin!==n)return void e(`Parent: Handshake - Received SYN message from origin ${i.origin} which did not match expected origin ${n}`);e("Parent: Handshake - Received SYN, responding with SYN-ACK");const r={penpal:A.SynAck,methodNames:Object.keys(t)};i.source.postMessage(r,o)}}(a,d,o,u),p=q(d,o,u,s,a),f=new Promise((function(e,n){const o=function(e,t){let n;return void 0!==e&&(n=window.setTimeout((function(){const n=new Error(`Connection timed out after ${e}ms`);n.code=j.ConnectionTimeout,t(n)}),e)),function(){clearTimeout(n)}}(i,c),r=function(n){if(n.source===t.contentWindow&&n.data)if(n.data.penpal!==A.Syn)if(n.data.penpal!==A.Ack);else{const t=p(n);t&&(o(),e(t))}else h(n)};window.addEventListener(U.Message,r),a("Parent: Awaiting handshake"),function(e,t){const{destroy:n,onDestroy:o}=t,i=setInterval((function(){e.isConnected||(clearInterval(i),n())}),6e4);o((function(){clearInterval(i)}))}(t,s),l((function(e){window.removeEventListener(U.Message,r),e&&n(e)}))}));return{promise:f,destroy(){c()}}},H=function(e){return e.Payment="payment",e.Installment="installment",e.Error="error",e.Cancel="cancel",e.Cryptogram="cryptogram",e.Sbp="sbp",e.Tinkoff="tinkoff",e.Spei="spei",e.Som="som",e.SberPay="sberPay",e.InstallmentKz="installmentKz",e}({}),X=function(e){return e.Success="success",e.Appointment="appointment",e.Fail="fail",e.Reject="reject",e.Cancel="cancel",e.Wait="wait",e}({});var K=!1;if("undefined"!=typeof window){var Y={get passive(){K=!0}};window.addEventListener("testPassive",null,Y),window.removeEventListener("testPassive",null,Y)}var J="undefined"!=typeof window&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||"MacIntel"===window.navigator.platform&&window.navigator.maxTouchPoints>1),Q=[],Z=!1,ee=-1,te=void 0,ne=void 0,oe=function(e){return Q.some((function(t){return!(!t.options.allowTouchMove||!t.options.allowTouchMove(e))}))},ie=function(e){var t=e||window.event;return!!oe(t.target)||(t.touches.length>1||(t.preventDefault&&t.preventDefault(),!1))},re=function(e,t){if(e){if(!Q.some((function(t){return t.targetElement===e}))){var n={targetElement:e,options:t||{}};Q=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Q),[n]),J?(e.ontouchstart=function(e){1===e.targetTouches.length&&(ee=e.targetTouches[0].clientY)},e.ontouchmove=function(t){1===t.targetTouches.length&&function(e,t){var n=e.targetTouches[0].clientY-ee;!oe(e.target)&&(t&&0===t.scrollTop&&n>0||function(e){return!!e&&e.scrollHeight-e.scrollTop<=e.clientHeight}(t)&&n<0?ie(e):e.stopPropagation())}(t,e)},Z||(document.addEventListener("touchmove",ie,K?{passive:!1}:void 0),Z=!0)):function(e){if(void 0===ne){var t=!!e&&!0===e.reserveScrollBarGap,n=window.innerWidth-document.documentElement.clientWidth;t&&n>0&&(ne=document.body.style.paddingRight,document.body.style.paddingRight=n+"px")}void 0===te&&(te=document.body.style.overflow,document.body.style.overflow="hidden")}(t)}}else console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.")},ae=function(e){e?(Q=Q.filter((function(t){return t.targetElement!==e})),J?(e.ontouchstart=null,e.ontouchmove=null,Z&&0===Q.length&&(document.removeEventListener("touchmove",ie,K?{passive:!1}:void 0),Z=!1)):Q.length||(void 0!==ne&&(document.body.style.paddingRight=ne,ne=void 0),void 0!==te&&(document.body.style.overflow=te,te=void 0))):console.error("enableBodyScroll unsuccessful - targetElement must be provided when calling enableBodyScroll on IOS devices.")},se={widget:{baseUrl:"https://widget.cloudpayments.ru",isProd:"true"}},le=function(){return a((function e(t){i(this,e),s(this,"_currentValue",void 0),s(this,"_subscribers",[]),this._currentValue=t}),[{key:"value",set:function(e){this._currentValue=e,this.notifySubscribers()}},{key:"subscribe",value:function(e){var t=this;return this._subscribers.push(e),function(){d(this,t);var n=this._subscribers.indexOf(e);this._subscribers.splice(n,1)}.bind(this)}},{key:"next",value:function(e){this.value=e}},{key:"notifySubscribers",value:function(){var e=this;this._subscribers.forEach(function(t){d(this,e),t(this._currentValue)}.bind(this))}},{key:"clear",value:function(){this._subscribers.length=0}}])}(),ce=function(){return a((function e(){i(this,e),s(this,"applePayPaymentResult",new le),s(this,"connection",null),s(this,"connectionResolvers",[]),s(this,"viewPortId",function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36,n=(new Date).getTime(),o="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){d(this,e);var i=16*Math.random();return n>0?(i=(n+i)%16|0,n=Math.floor(n/16)):(i=(o+i)%16|0,o=Math.floor(o/16)),("x"===t?i:3&i|8).toString(16)}.bind(this)).slice(0,t)}())}),[{key:"getConnection",value:function(){var e=this;return new Promise(function(t,n){var o=this;if(d(this,e),S.isIE()){var i=function(e){if(d(this,o),e.origin===se.widget.baseUrl){try{"close"===JSON.parse(e.data).action&&this.hideWindow()}catch(e){return}window.removeEventListener("message",i)}}.bind(this);return window.addEventListener("message",i,!1),this.showWindow(),void n("IE")}null!=this.connection?t(this.connection):this.connectionResolvers.push(t)}.bind(this))}},{key:"showWindow",value:function(){var e,t,n=this;this.container&&(this.addViewPortMeta(),S.addClass(this.iframe,"with-appled"),e=document,(t=e.getElementById("payment-loading-overlay-63456123"))&&t.parentNode&&t.parentNode.removeChild(t),S.showHtmlElement(this.container),re(this.container),this.alternateEmbed&&!this.appledStyle&&(this.savedScrollPosition=document.body.scrollTop,this.appledStyle=document.createElement("style"),this.appledStyle.type="text/css",this.appledStyle.innerHTML="\n                html {height: 100% !important; position: static !important}\n                body {margin: 0 !important; padding: 0 !important; position: static !important; height: 100vh !important; overscroll-behavior: none !important}\n                body * {display: none !important}\n                #".concat(this.container.id," {position: static !important}\n                #").concat(this.container.id,", #payments-backdrop-8978968765, iframe.with-appled {display: block !important}\n                .payment-tools-container.with-appled {display: table !important}\n                .payment-tools-container.with-appled div {display: table-cell !important}\n                .payment-tools-container.with-appled div *:not(style) {display: block !important}\n            "),document.body.appendChild(this.appledStyle),setTimeout(function(){d(this,n),window.scrollTo(0,0)}.bind(this),200)))}},{key:"hideWindow",value:function(){if(ae(this.container),this.savedScrollPosition&&(window.scrollTo(0,this.savedScrollPosition),this.savedScrollPosition=null),this.appledStyle){try{this.appledStyle.remove()}catch(e){}this.appledStyle=null}this.removeViewPortMeta(),this.iframe&&S.removeClass(this.iframe,"with-appled"),S.hideHtmlElement(this.container);try{this.container.remove()}catch(e){}this.onFrameDestroyed&&this.onFrameDestroyed(this.completedData)}},{key:"addViewPortMeta",value:function(){var e=document.getElementsByTagName("head")[0],t=document.createElement("meta");t.id=this.viewPortId,t.name="viewport",t.content="width=device-width, height=device-height, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no",e.appendChild(t)}},{key:"removeViewPortMeta",value:function(){var e=document.getElementById(this.viewPortId);e&&document.getElementsByTagName("head")[0].removeChild(e)}},{key:"getWindow",value:function(){var e;return null===(e=this.iframe.contentWindow)||void 0===e?void 0:e.window}},{key:"setApplePayPaymentResult",value:function(e){this.applePayPaymentResult.next(e)}},{key:"processApplePaySessionAndPay",value:(e=n(m().mark((function e(t,n){var o,i=this;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new ApplePaySession(1,t),console.log("processApplePaySessionAndPay widget next with applePaySession:",o),e.abrupt("return",new Promise(function(e,t){var n=this;d(this,i),o.oncancel=function(e){d(this,n),t(e)}.bind(this),o.onvalidatemerchant=function(e){d(this,n)}.bind(this),o.onpaymentauthorized=function(e){d(this,n)}.bind(this),o.begin()}.bind(this)));case 3:case"end":return e.stop()}}),e,this)}))),function(t,n){return e.apply(this,arguments)})}],[{key:"createContainer",value:function(e,t){var n=document.createElement("div");if(n.id="cp-scrollable-".concat(Math.floor(1e8*Math.random()).toString()),!e&&(n.style.cssText='z-index:99997;text-align:left;height:100%;width:100%;"position: fixed;"left:0;top:0;transition:opacity 0.15s;overflow:auto;-webkit-overflow-scrolling:touch;pointer-events:all;',t))for(var o in t)n.style.setProperty(o,t[o]);return n.style.pointerEvents="all",n}},{key:"ensureContainer",value:function(e){if(null==e)return document.body;if("string"==typeof e){var t=document.getElementById(e);return null==t?(console.warn("Specified container with id ".concat(e," not found. document.body will used instead")),document.body):t}if("object"===g(e)&&1===e.nodeType)return e;throw new Error("Argument 'container' must be an ID of element or the element itself")}}]);var e}(),ue=function(e){function t(e,n,r,a){var l,c=this;if(i(this,t),s(l=o(this,t),"applePaySessions",new Map),S.isIE()){l.iframe=document.createElement("iframe");var u=new URL("".concat(se.widget.baseUrl,"/next/app/widget"));return l.iframe.src=u.toString(),l.iframe.style.cssText="height: 100% !important;width: 100% !important;position: fixed !important;z-index: 999999 !important;border: 0 !important; top: 0 !important;bottom: 0 !important;left: 0 !important;right: 0px !important;max-height: 100% !important;",l.container=t.createContainer(l.alternateEmbed),l.container.appendChild(l.iframe),t.ensureContainer(n).appendChild(l.container),l.hideWindow(),f(l)}l.alternateEmbed=e,l.iframe=document.createElement("iframe");var h=new URL("".concat(se.widget.baseUrl,"/next/app/widget"));r&&h.searchParams.append("locale",r),a&&h.searchParams.append("debug","true"),l.iframe.src=h.toString(),l.iframe.allowPaymentRequest=!0,l.iframe.setAttribute("allow","payment"),l.iframe.style.cssText="height: 100% !important;width: 100% !important;position: fixed !important;z-index: 99999 !important;border: 0 !important; top: 0 !important; top: env(safe-area-inset-top, 0) !important;bottom: 0 !important;left: 0 !important;right: 0px !important;max-height: 100% !important;",l.container=t.createContainer(l.alternateEmbed),l.container.appendChild(l.iframe),l.hideWindow(),t.ensureContainer(n).appendChild(l.container);var m={externalHref:function(){return d(this,c),window.location.href}.bind(this),showWindow:l.showWindow.bind(l),hideWindow:l.hideWindow.bind(l),setApplePaymentResult:l.setApplePayPaymentResult.bind(l),processApplePayment:l.processApplePaySessionAndPay.bind(l),on3ds:function(){throw d(this,c),new Error("Not implemented")}.bind(this),onFrameResize:function(){throw d(this,c),new Error("Not implemented")}.bind(this),completeWidgetCallback:function(e,t){var n,o;if(d(this,c),l.onPaymentCompleted){var i,r=p({},e);if(null!=e&&null!==(i=e.data)&&void 0!==i&&i.Model){var a,s,u=null==r||null===(a=r.data)||void 0===a||null===(a=a.Model)||void 0===a?void 0:a.TransactionId,h=null==r||null===(s=r.data)||void 0===s||null===(s=s.Model)||void 0===s?void 0:s.ReasonCode;r.data={email:t},u&&(r.data.transactionId=u),h&&(r.data.ReasonCode=h)}e.type===H.Installment&&delete r.data,l.onPaymentCompleted(r),e.type===H.Cryptogram&&l.hideWindow()}var f={success:(null==e?void 0:e.status)===X.Success,message:(null==e||null===(n=e.data)||void 0===n?void 0:n.Message)||null,code:(null==e||null===(o=e.data)||void 0===o||null===(o=o.Model)||void 0===o?void 0:o.ReasonCode)||0,email:t};l.completedData=f,e&&l.onComplete&&l.onComplete(f)}.bind(this),isApplePayAvailiable:function(){return d(this,c),"ApplePaySession"in window&&ApplePaySession.canMakePayments()}.bind(this),openLink:function(e){d(this,c),window.location.href=e}.bind(this),oncancel:function(e){var t=this;d(this,c),console.log("oncancel frame connector start");var n=l.applePaySessions.get(e);return n?new Promise(function(e,o){var i=this;if(d(this,t),n.oncancel){var r=n.oncancel.bind(n);n.oncancel=function(t){d(this,i),console.log("oncancel frame connector in promise inner"),r(t),e({error:t.sessionError,type:t.type})}.bind(this)}else n.oncancel=function(t){d(this,i),console.log("oncancel frame connector in promise alone"),e({error:t.sessionError,type:t.type})}.bind(this)}.bind(this)):(console.log("oncancel frame connector end"),Promise.resolve())}.bind(this),addApplePaySession:function(e,t){d(this,c),console.log("addApplePaySession frame connector start",l.applePaySessions,"intent",t);var n=function(e){var t,n,o;if(!e)throw new Error("No intent data");const i=null===(t=e.paymentMethods)||void 0===t?void 0:t.find((function(e){return e.type===P}));if(!i)throw new Error("Missing ApplePay configuration in intent");const r={countryCode:i.countryCode,currencyCode:e.currency,supportedNetworks:i.supportedNetworks,merchantCapabilities:i.merchantCapabilities,total:{label:null!==(n=e.description)&&void 0!==n?n:`Pay to ${e.paymentUrl}`,amount:null===(o=e.amount)||void 0===o?void 0:o.toString()}};return e.emailBehavior===b.REQUIRED&&(r.requiredShippingContactFields=["email"]),r}(t);console.log("applePaymentRequest",n),l.applePaySessions.set(e,new ApplePaySession(1,n)),console.log("addApplePaySession frame connector end",l.applePaySessions,l.applePaySessions.get(e))}.bind(this),removeApplePaySession:function(e){d(this,c),l.applePaySessions.delete(e)}.bind(this),getApplePaySession:function(e){return d(this,c),console.log("getApplePaySession frame connector start",l.applePaySessions,e,l.applePaySessions.has(e)),l.applePaySessions.get(e)}.bind(this),begin:function(e){d(this,c);var t=l.applePaySessions.get(e);return t?(t.begin(),console.log("session with id ".concat(e," started begin"))):console.log("session with id ".concat(e," not found begin")),Promise.resolve()}.bind(this),completeMerchantValidation:function(e,t){d(this,c);var n=l.applePaySessions.get(t);return console.log("completeMerchantValidation frame connector start"),n?(n.completeMerchantValidation(e),console.log("session with id ".concat(t," merchant validation completed completeMerchantValidation")),Promise.resolve("")):(console.log("session with id ".concat(t," not found completeMerchantValidation")),Promise.reject())}.bind(this),completePayment:function(e,t){d(this,c);var n=l.applePaySessions.get(t);return n?(n.completePayment(e),console.log("session with id ".concat(t," payment completed completePayment"))):console.log("session with id ".concat(t," not found completePayment")),Promise.resolve()}.bind(this)};return m.onpaymentauthorized=function(e){var t=this;d(this,c),console.log("onpaymentauthorized frame connector start");var n=l.applePaySessions.get(e);return n?new Promise(function(o,i){var r=this;d(this,t),n.onpaymentauthorized=function(e){d(this,r),console.log("onpaymentauthorized frame connector in promise"),o(JSON.stringify(e.payment.token))}.bind(this),m.oncancel(e).then(i)}.bind(this)):(console.log("onpaymentauthorized frame connector end"),Promise.resolve())}.bind(this),m.onvalidatemerchant=function(e){var t=this;d(this,c),console.log("onvalidatemerchant frame connector start");var n=l.applePaySessions.get(e);return n?new Promise(function(o,i){var r=this;d(this,t),n.onvalidatemerchant=function(e){d(this,r),console.log("onvalidatemerchant frame connector in promise"),o(e.validationURL)}.bind(this),m.oncancel(e).then(i)}.bind(this)):(console.log("onvalidatemerchant frame connector end"),Promise.resolve())}.bind(this),l.connectionHandler=z({iframe:l.iframe,methods:m}),l.connectionHandler.promise.then(function(e){var t=this;d(this,c),l.connection=e,l.connectionResolvers.forEach(function(n){return d(this,t),n(e)}.bind(this))}.bind(this)),l}return c(t,e),a(t)}(ce);function de(e){return{type:H.Error,data:e}}var he=function(){return a((function e(){i(this,e)}),null,[{key:"validate",value:function(e,t,n){var o,i=this;if(!e.publicTerminalId)throw new Error("Option 'publicTerminalId' must be specified");if(!e.amount)throw new Error("Option 'amount' must be specified");if("number"!=typeof e.amount)throw new Error("Option 'amount' must be a number");if(!e.currency)throw new Error("Option 'currency' must be specified");if(e.receiptEmail&&"string"!=typeof e.receiptEmail)throw new Error("Option 'receiptEmail' must be a string");if(n&&"function"!=typeof n)throw new Error("Argument 'onCompleted' must be a function");if(e.emailBehavior&&!Object.values(b).some(function(t){return d(this,i),e.emailBehavior===t}.bind(this)))throw new Error("Option 'emailBehavior' must be a one of the following values: ".concat(Object.values(b).join(", ")));if(!e.receiptEmail&&t.email&&(e.receiptEmail=t.email),e.successRedirectUrl&&"string"!=typeof e.successRedirectUrl)throw new Error("Argument 'successRedirectUrl' must be a string");if(e.failRedirectUrl&&"string"!=typeof e.failRedirectUrl)throw new Error("Argument 'failRedirectUrl' must be a string");if((e.paymentMethodsNotfoldedCount||0===e.paymentMethodsNotfoldedCount)&&(!Number.isInteger(e.paymentMethodsNotfoldedCount)||0===e.paymentMethodsNotfoldedCount))throw new Error("Option 'paymentMethodsNotfoldedCount' must be a integer");if(null!==(o=e.paymentMethodSequence)&&void 0!==o&&o.length){if(!Array.isArray(e.paymentMethodSequence))throw new Error("Option 'paymentMethodSequence' must be an array");e.paymentMethodSequence.forEach(function(e){if(d(this,i),"string"!=typeof e&&"number"!=typeof e)throw new Error("Option 'paymentMethodSequence' include not valid element")}.bind(this))}}}])}(),pe=function(){return a((function e(){i(this,e)}),null,[{key:"validate",value:function(e,t,n){var o=this;if(!e.publicId)throw new Error("Option 'publicId' must be specified");if(!e.amount)throw new Error("Option 'amount' must be specified");if("number"!=typeof e.amount)throw new Error("Option 'amount' must be a number");if(!e.currency)throw new Error("Option 'currency' must be specified");if(e.email&&"string"!=typeof e.email)throw new Error("Option 'email' must be a string");if(n&&"function"!=typeof n)throw new Error("Option 'onCompleted' must be a function");var i=!!e.requireEmail,r=!!e.disableEmail,a=!!e.emailBehavior;if(a&&(i||r))throw new Error("Option 'emailBehavior' can't be defined with options 'requireEmail' or 'disableEmail' simultaneously");if(a&&!Object.values(b).some(function(t){return d(this,o),e.emailBehavior===t}.bind(this)))throw new Error("Option 'emailBehavior' must be a one of the following values: ".concat(Object.values(b).join(", ")));if(i&&"boolean"!=typeof e.requireEmail)throw new Error("Option 'requireEmail' must be a boolean");if(r&&"boolean"!=typeof e.disableEmail)throw new Error("Option 'disableEmail' must be a boolean");if(!e.email&&t.email&&(e.email=t.email),e.configuration){var s;if(e.configuration.installment&&"object"!==g(e.configuration.installment))throw new Error("Option 'configuration.installment' must be a object");if(e.configuration.installment&&e.configuration.installment.promoCode&&"string"!=typeof e.configuration.installment.promoCode)throw new Error("Option 'configuration.installment.promoCode' must be a string");if(e.configuration.common&&e.configuration.common.successRedirectUrl&&"string"!=typeof e.configuration.common.successRedirectUrl)throw new Error("Option 'configuration.common.successRedirectUrl' must be a string");if(e.configuration.common&&e.configuration.common.failRedirectUrl&&"string"!=typeof e.configuration.common.failRedirectUrl)throw new Error("Option 'configuration.common.failRedirectUrl' must be a string");if((e.configuration.paymentMethodsNotfoldedCount||0===e.configuration.paymentMethodsNotfoldedCount)&&(!Number.isInteger(e.configuration.paymentMethodsNotfoldedCount)||0===e.configuration.paymentMethodsNotfoldedCount))throw new Error("Option 'paymentMethodsNotfoldedCount' must be a integer");if(null!==(s=e.configuration.paymentMethodsOrder)&&void 0!==s&&s.length){if(!Array.isArray(e.configuration.paymentMethodsOrder))throw new Error("Option 'paymentMethodsOrder' must be an array");e.configuration.paymentMethodsOrder.forEach(function(e){if(d(this,o),!Number.isInteger(e)&&"string"!=typeof e)throw new Error("Option 'paymentMethodsOrder' include not valid element")}.bind(this))}}if(e.escrow){if("RUB"!==e.currency)throw new Error("Option 'escrow' is not allowed with currency other than 'RUB'");if(null==e.escrow.accumulationId&&null==e.escrow.startAccumulation)throw new Error("Option 'escrow.accumulationId' or 'escrow.startAccumulation' are required with escrow");if(e.escrow.accumulationId&&!0===e.escrow.startAccumulation)throw new Error("Only 'escrow.accumulationId' or 'escrow.startAccumulation' allowed at same time");if(null!=e.escrow.accumulationId&&"string"!=typeof e.escrow.accumulationId)throw new Error("Option 'escrow.accumulationId' must be a string");if(null!=e.escrow.startAccumulation&&"boolean"!=typeof e.escrow.startAccumulation)throw new Error("Option 'escrow.accumulationId' must be a boolean")}}}])}(),fe=function(e){return e[e.ApplePay=0]="ApplePay",e[e.GooglePay=1]="GooglePay",e[e.MasterPass=2]="MasterPass",e[e.YandexPay=3]="YandexPay",e[e.TinkoffInstallmentPay=4]="TinkoffInstallmentPay",e[e.SbpPay=5]="SbpPay",e[e.TinkoffPay=6]="TinkoffPay",e[e.MirPay=7]="MirPay",e[e.Spei=8]="Spei",e[e.TcsBnplDolyame=9]="TcsBnplDolyame",e[e.MtsPay=10]="MtsPay",e[e.Som=11]="Som",e[e.SberPay=12]="SberPay",e[e.TinkoffCredit=13]="TinkoffCredit",e[e.InstallmentKz=17]="InstallmentKz",e[e.Card=99]="Card",e}({}),me=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(this,t),s(e=o(this,t),"alternateEmbed",!1),s(e,"deviceDetector",new E),s(e,"frameDestroyed",!1),e.options=e.setWidgetOptionsDefaults(n),n.debug,e.alternateEmbed=e.deviceDetector.isIOs||e.deviceDetector.isAndroid,e.containerManager=e.createFrameConnector(),e}return c(t,e),a(t,[{key:"pay",value:function(e,t,n){var o=this;return this.legacyCallbackObject.onSuccess=null==n?void 0:n.onSuccess,this.legacyCallbackObject.onFail=null==n?void 0:n.onFail,this.legacyCallbackObject.onComplete=null==n?void 0:n.onComplete,new Promise(function(n){d(this,o),this.onCloseWidgetResolver=n,this.startPayment(e,t,!0)}.bind(this))}},{key:"charge",value:function(e,t,n,o){e.auth=!1,this.legacyCallbackObject.onSuccess=t,this.legacyCallbackObject.onFail=n,this.legacyCallbackObject.onComplete=o,this.startPayment(I.Charge,e,!1)}},{key:"auth",value:function(e,t,n,o){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(i&&"boolean"!=typeof i)throw new Error("Argument 'auth' must be a boolean");e.auth=!0,this.legacyCallbackObject.onSuccess=t,this.legacyCallbackObject.onFail=n,this.legacyCallbackObject.onComplete=o,this.startPayment(I.Auth,e,!1)}},{key:"start",value:function(e,t){var n=this;return this.legacyCallbackObject.onSuccess=null==t?void 0:t.onSuccess,this.legacyCallbackObject.onFail=null==t?void 0:t.onFail,this.legacyCallbackObject.onComplete=null==t?void 0:t.onComplete,new Promise(function(t){d(this,n),this.onCloseWidgetResolver=t,this.startIntentPayment(e,!0)}.bind(this))}},{key:"close",value:function(){this.containerManager&&(this.containerManager.hideWindow(),this.containerManager=void 0)}},{key:"startPayment",value:function(e,t){var n=this,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.paymentOptions)throw new Error("Payment options already set. Prevented multiply widget windows.");if(e!==I.Auth&&e!==I.Charge)throw new Error("Option 'type' must be 'auth' or 'charge'");try{this.validateOptions(t)}catch(e){var i=this.onCloseWidgetResolver&&(null==e?void 0:e.message);if(this.logValidationError(t,e,!i),i)return this.lastCallbackResult=de(e.message),void this.invokeCallbacks(this.merchantPaymentOptions)}var r=new x(t,e,this.options.cryptogramMode);k(document),this.paymentOptions=r,this.merchantPaymentOptions=t,this.legacyCallbackObject.shouldInvokeOnCompleteInstantly=o,this.frameDestroyed&&(this.containerManager=this.createFrameConnector()),this.containerManager.getConnection().then(function(e){d(this,n),e.setOptions(this.paymentOptions,{origin:this.getOrigin.call(this)},this.options)}.bind(this)).catch(function(){d(this,n),console.warn("IE Detected. Payment prevented.")}.bind(this)),history.pushState({paymentOptions:t,options:this.options},"PaymentWidget",window.location.href)}},{key:"startIntentPayment",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.intentOptions||this.paymentOptions)throw new Error("Payment intent options already set. Prevented multiply widget windows.");if(!e.paymentSchema||![w.DUAL,w.SINGLE].includes(e.paymentSchema))throw new Error("Option 'paymentSchema' must be 'Single' or 'Dual'");try{this.validateIntentOptions(e)}catch(t){var o=this.onCloseWidgetResolver&&(null==t?void 0:t.message);if(this.logValidationError(e,t,!o),o)return this.lastCallbackResult=de(t.message),void this.invokeCallbacks(this.merchantPaymentOptions)}k(document),this.intentOptions=e,this.legacyCallbackObject.shouldInvokeOnCompleteInstantly=n,this.frameDestroyed&&(this.containerManager=this.createFrameConnector()),this.containerManager.getConnection().then(function(e){d(this,t),e.setOptions(this.paymentOptions,{origin:this.getOrigin.call(this)},this.options,this.intentOptions)}.bind(this)).catch(function(){d(this,t),console.warn("IE Detected. Payment prevented.")}.bind(this)),history.pushState({intentOptions:e,options:this.options},"PaymentWidget",window.location.href)}},{key:"setWidgetOptionsDefaults",value:function(e){var t=p({},e);if(S.isNullOrUndefined(t.showLoadingImage)&&(t.showLoadingImage=!0),S.isNullOrUndefined(t.applePaySupport)&&(t.applePaySupport=!0),S.isNullOrUndefined(t.googlePaySupport)&&(t.googlePaySupport=!0),S.isNullOrUndefined(t.installmentKzSupport)&&(t.installmentKzSupport=!0),S.isNullOrUndefined(t.tinkoffInstallmentSupport)&&(t.tinkoffInstallmentSupport=!0),S.isNullOrUndefined(t.tinkoffPaySupport)&&(t.tinkoffPaySupport=!0),S.isNullOrUndefined(t.speiSupport)&&(t.speiSupport=!0),S.isNullOrUndefined(t.yandexPaySupport)&&(t.yandexPaySupport=!0),S.isNullOrUndefined(t.sbpSupport)&&(t.sbpSupport=!0),S.isNullOrUndefined(t.mirPaySupport)&&(t.mirPaySupport=!0),S.isNullOrUndefined(t.foreignSupport)&&(t.foreignSupport=!0),S.isNullOrUndefined(t.sberPaySupport)&&(t.sberPaySupport=!0),S.isNullOrUndefined(t.masterPassSupport)&&(t.masterPassSupport=!0),S.isNullOrUndefined(t.cryptogramMode)&&(t.cryptogramMode=!1),!S.isNullOrUndefined(t.logoUrl))try{if(function(e){if(e.startsWith("data:image/"))return!1;try{return Boolean(new URL(e))}catch(e){return!1}}(t.logoUrl)){var n=new URL(t.logoUrl);t.logoUrl=-1!==n.href.indexOf("static.cloudpayments.ru")||-1!==n.href.indexOf("static-preprod.cloudpayments.ru")||-1!==n.href.indexOf("static-stage.cloudpayments.ru")?n.href:void 0}else if(!function(e){if(e.startsWith("data:image/")){var t="data:image/jpeg;base64",n="data:image/png;base64";return e.startsWith(t)?"/"===e[23]:!!e.startsWith(n)&&"i"===e[22]}return!1}(t.logoUrl))throw new Error("Logo is not an url and not valid base64 image")}catch(e){t.logoUrl=void 0}return t}},{key:"createFrameConnector",value:function(){var e=this,t=new ue(this.alternateEmbed,this.options.container,this.options.language,this.options.debug);return t.onFrameDestroyed=function(t,n){d(this,e);try{this.invokeCallbacks(this.merchantPaymentOptions,t,n)}catch(e){}this.paymentOptions=void 0,this.intentOptions=void 0,this.merchantPaymentOptions=void 0,this.frameDestroyed=!0}.bind(this),t.onComplete=function(t){d(this,e),this.legacyCallbackObject.onComplete&&this.legacyCallbackObject.shouldInvokeOnCompleteInstantly&&this.legacyCallbackObject.onComplete(t,this.merchantPaymentOptions)}.bind(this),t.onPaymentCompleted=function(t){d(this,e),this.lastCallbackResult=t,this.onCloseWidgetResolver&&t.type===H.Cryptogram&&this.onCloseWidgetResolver(t),t.type!==H.Cryptogram&&this.oncomplete&&this.oncomplete(t)}.bind(this),this.frameDestroyed=!1,t}},{key:"validateOptions",value:function(e,t){return pe.validate(e,this.options,t)}},{key:"validateIntentOptions",value:function(e,t){return he.validate(e,this.options,t)}},{key:"logValidationError",value:function(e,t,n){var o,i=this;null===(o=this.containerManager)||void 0===o||null===(o=o.getConnection())||void 0===o||null===(o=o.then(function(o){d(this,i);var r={publicId:null==e?void 0:e.publicId,publicTerminalId:null==e?void 0:e.publicTerminalId,amount:null==e?void 0:e.amount,currency:null==e?void 0:e.currency,description:null==e?void 0:e.description,emailBehavior:null==e?void 0:e.emailBehavior,requireEmail:null==e?void 0:e.requireEmail,cryptogramMode:null==e?void 0:e.cryptogramMode,retryPayment:null==e?void 0:e.retryPayment,accountId:null==e?void 0:e.accountId,invoiceId:null==e?void 0:e.invoiceId,paymentUrl:this.getOrigin()};o.logValidationError(r,(null==t?void 0:t.message)||"",n)}.bind(this)))||void 0===o||o.catch(function(){d(this,i),console.warn("IE Detected. logValidationError prevented.")}.bind(this))}},{key:"getOrigin",value:function(){return"null"!==window.location.origin||window===window.parent?window.location.origin:document.referrer}}])}(function(){return a((function e(){i(this,e),s(this,"legacyCallbackObject",{shouldInvokeOnCompleteInstantly:!1}),s(this,"lastCallbackResult",{type:H.Cancel}),s(this,"callbackObject",{}),s(this,"onCloseWidgetResolver",null)}),[{key:"onclose",get:function(){return this.callbackObject.onClose},set:function(e){if(e&&"function"!=typeof e)throw new Error("Function required");this.callbackObject.onClose=e}},{key:"oncomplete",get:function(){return this.callbackObject.onPaymentCompleted},set:function(e){if(e&&"function"!=typeof e)throw new Error("Function required");this.callbackObject.onPaymentCompleted=e}},{key:"oncryptogram",get:function(){return this.callbackObject.onCryptogramCreated},set:function(e){if(e&&"function"!=typeof e)throw new Error("Function required");this.callbackObject.onCryptogramCreated=e}},{key:"invokeCallbacks",value:function(e,t,n){var o,i,r;t?(t.success&&this.legacyCallbackObject.onSuccess&&("function"==typeof this.legacyCallbackObject.onSuccess?this.legacyCallbackObject.onSuccess(e):window.location.replace(this.legacyCallbackObject.onSuccess)),!t.success&&this.legacyCallbackObject.onFail&&("function"==typeof this.legacyCallbackObject.onFail?this.legacyCallbackObject.onFail(t.message,e,null===(o=t.code)||void 0===o?void 0:o.toString()):window.location.replace(this.legacyCallbackObject.onFail))):n||this.legacyCallbackObject.onFail&&("function"==typeof this.legacyCallbackObject.onFail?this.legacyCallbackObject.onFail("User has cancelled",e,void 0):window.location.replace(this.legacyCallbackObject.onFail));!this.legacyCallbackObject.shouldInvokeOnCompleteInstantly&&this.legacyCallbackObject.onComplete&&this.legacyCallbackObject.onComplete({success:null!==(i=null==t?void 0:t.success)&&void 0!==i&&i,message:null==t?void 0:t.message,code:null==t?void 0:t.code},e);(n&&this.legacyCallbackObject.onSuccess&&"function"==typeof this.legacyCallbackObject.onSuccess&&this.legacyCallbackObject.onSuccess(e,null==n?void 0:n.cryptogram,null==n?void 0:n.email),this.onCloseWidgetResolver&&this.lastCallbackResult)?null!==(r=this.lastCallbackResult)&&void 0!==r&&r.status&&[X.Success,X.Appointment].includes(this.lastCallbackResult.status)&&[H.Payment,H.Installment].includes(this.lastCallbackResult.type)?this.onCloseWidgetResolver(this.lastCallbackResult):this.lastCallbackResult&&this.lastCallbackResult.type===H.Error?this.onCloseWidgetResolver(p(p({},this.lastCallbackResult),{},{type:H.Error})):this.onCloseWidgetResolver({type:H.Cancel}):this.onclose&&this.lastCallbackResult&&this.onclose(p(p({},this.lastCallbackResult),{},{type:H.Cancel}))}}])}()),ye=me,ve=me,ge={event:{status:{success:X.Success,fail:X.Fail,appointment:X.Appointment},type:{payment:H.Payment,installment:H.Installment,error:H.Error,cancel:H.Cancel}},escrow:{NToOne:_.NToOne,OneToN:_.OneToN},ExternalPaymentMethods:fe};e.CloudPayments=ye,e.Widget=ve,e.constant=ge,Object.defineProperty(e,"__esModule",{value:!0})}(this.cp=this.cp||{});
